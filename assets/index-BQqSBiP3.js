(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function o(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(n){if(n.ep)return;n.ep=!0;const i=o(n);fetch(n.href,i)}})();const N=document.querySelector("#app");N.innerHTML=`
  <h1>LinkHub</h1>
  <div id="dropbox-bar" style="display:flex;gap:0.5em;align-items:center;margin-bottom:0.75em;">
    <span id="dropbox-status" style="font-size:0.9em;color:#888;">Dropbox: desconectado</span>
    <button id="dropbox-connect" type="button">Conectar Dropbox</button>
    <button id="dropbox-sync" type="button" disabled>Sincronizar ahora</button>
  </div>
  <form id="link-form" hidden>
    <input type="url" id="url" placeholder="Enlace (https://...)" required />
    <input type="text" id="title" placeholder="Título" required />
    <input type="text" id="tags" list="tags-datalist" placeholder="Etiquetas (separadas por coma)" />
    <datalist id="tags-datalist"></datalist>
    <input type="text" id="category" list="categories-datalist" placeholder="Categoría" />
    <datalist id="categories-datalist"></datalist>
    <div style="margin-top:0.6em;display:flex;gap:0.5em;flex-wrap:wrap;justify-content:center;">
      <button type="submit">Añadir enlace</button>
    </div>
  </form>
  <div style="margin:1em 0;">
    <button id="export-btn">Exportar enlaces</button>
    <input type="file" id="import-file" accept="application/json" style="display:none;" />
    <button id="import-btn" type="button">Importar enlaces</button>
  </div>
  <div style="margin:1em 0;">
    <input type="text" id="search" placeholder="Buscar enlaces..." style="width:60%;max-width:400px;" />
  </div>
  <div style="margin:1em 0;">
    <label>Filtrar por categoría:
      <select id="filter-category">
        <option value="">Todas</option>
      </select>
    </label>
    <label style="margin-left:1em;">Filtrar por etiqueta:
      <select id="filter-tag">
        <option value="">Todas</option>
      </select>
    </label>
  </div>
  <h2>Enlaces guardados</h2>
  <div id="links-list"></div>
  <footer style="margin-top:2em;color:#888;font-size:0.9em;">SW: <span id="sw-version">(cargando...)</span></footer>
`;let I=null;(function(){try{let t=function(){s.classList.add("open"),s.setAttribute("aria-hidden","false")},o=function(){s.classList.remove("open"),s.setAttribute("aria-hidden","true")};const a=document.getElementById("link-form"),n=document.createElement("div");n.id="top-actions",n.style.margin="0.5em 0",a&&a.parentNode&&a.insertAdjacentElement("afterend",n);const i=document.createElement("button");i.id="add-open",i.type="button",i.className="btn--primary",i.textContent="Añadir enlace",n.appendChild(i),N.insertAdjacentHTML("beforeend",`
      <div id="add-modal" class="modal-backdrop" aria-hidden="true">
        <div class="modal-panel" role="dialog" aria-modal="true" aria-labelledby="add-title">
          <div class="modal-header">
            <h2 id="add-title">Añadir enlace</h2>
            <button id="add-close" type="button" aria-label="Cerrar">✕</button>
          </div>
          <div class="modal-section">
            <div id="add-form-slot"></div>
          </div>
          <div class="modal-footer">
            <button id="add-close-2" type="button">Cerrar</button>
          </div>
        </div>
      </div>
    `);const s=document.getElementById("add-modal");document.getElementById("add-form-slot").appendChild(a),a.hidden=!1;const r=a.querySelector('button[type="submit"]');r&&r.classList.add("btn--primary"),i.addEventListener("click",t),document.getElementById("add-close").addEventListener("click",o),document.getElementById("add-close-2").addEventListener("click",o),s.addEventListener("click",c=>{c.target===s&&o()}),window.__openAddModal=t}catch(t){console.warn("Add modal setup error:",t)}})();(function(){try{let t=function(){u.classList.add("open"),u.setAttribute("aria-hidden","false")},o=function(){u.classList.remove("open"),u.setAttribute("aria-hidden","true")},a=function(d){const g=window.matchMedia&&window.matchMedia("(prefers-color-scheme: light)").matches,dt=(d==="auto"?g?"light":"dark":d)==="light"?"#ffffff":"#242424";let k=document.querySelector('meta[name="theme-color"][data-override]');k||(k=document.createElement("meta"),k.setAttribute("name","theme-color"),k.setAttribute("data-override","true"),document.head.appendChild(k)),k.setAttribute("content",dt)},n=function(d){const g=document.documentElement;g.classList.remove("theme-light","theme-dark"),d==="light"?g.classList.add("theme-light"):d==="dark"&&g.classList.add("theme-dark"),a(d)};const i=document.getElementById("top-actions")||function(){const d=document.getElementById("link-form"),g=document.createElement("div");return g.id="top-actions",g.style.margin="0.5em 0",d&&d.parentNode&&d.insertAdjacentElement("afterend",g),g}(),s=document.createElement("button");s.id="settings-open",s.type="button",s.className="btn--ghost",s.textContent="Configuración",i.appendChild(s),N.insertAdjacentHTML("beforeend",`
      <div id="settings-modal" class="modal-backdrop" aria-hidden="true">
        <div class="modal-panel" role="dialog" aria-modal="true" aria-labelledby="settings-title">
          <div class="modal-header">
            <h2 id="settings-title">Configuración</h2>
            <button id="settings-close" type="button" aria-label="Cerrar">✕</button>
          </div>
          <div class="modal-section">
            <h3>Tema</h3>
            <label for="theme-select">Modo:</label>
            <select id="theme-select">
              <option value="auto">Automático (sistema)</option>
              <option value="light">Claro</option>
              <option value="dark">Oscuro</option>
            </select>
          </div>
          <div class="modal-section">
            <h3>Dropbox</h3>
            <div id="modal-dropbox"></div>
          </div>
          <div class="modal-section">
            <h3>Datos</h3>
            <div id="modal-data"></div>
          </div>
          <div class="modal-footer">
            <button id="settings-close-2" type="button">Cerrar</button>
          </div>
        </div>
      </div>
    `);const u=document.getElementById("settings-modal"),r=u.querySelector("#theme-select"),c=u.querySelector("#modal-dropbox"),b=u.querySelector("#modal-data"),l=document.getElementById("dropbox-bar");if(l){c.appendChild(l);const d=document.createElement("button");d.id="dropbox-disconnect",d.type="button",d.textContent="Desconectar",d.disabled=!0,l.appendChild(d),I=d}const m=document.getElementById("export-btn");if(m&&m.parentElement){const d=m.parentElement;b.appendChild(d)}const S=document.getElementById("settings-open"),ct=document.getElementById("settings-close"),lt=document.getElementById("settings-close-2");S.addEventListener("click",t),ct.addEventListener("click",o),lt.addEventListener("click",o),u.addEventListener("click",d=>{d.target===u&&o()});const X=localStorage.getItem("themeMode")||"auto";n(X),r&&(r.value=X,r.addEventListener("change",()=>{const d=r.value;localStorage.setItem("themeMode",d),n(d)})),window.matchMedia&&window.matchMedia("(prefers-color-scheme: light)").addEventListener("change",()=>{(localStorage.getItem("themeMode")||"auto")==="auto"&&n("auto")})}catch(t){console.warn("Settings modal setup error:",t)}})();const p=document.getElementById("link-form"),Y=document.getElementById("links-list"),ut=document.getElementById("export-btn"),mt=document.getElementById("import-btn"),D=document.getElementById("import-file"),q=document.getElementById("filter-category"),R=document.getElementById("filter-tag"),nt=document.getElementById("search"),Q=document.getElementById("tags-datalist"),Z=document.getElementById("categories-datalist"),x=document.getElementById("dropbox-status"),j=document.getElementById("dropbox-connect"),P=document.getElementById("dropbox-sync"),tt=document.getElementById("sw-version");function v(){return Date.now()}function ot(){const e=Math.random().toString(36).slice(2,8);return"l_"+v().toString(36)+"_"+e}function w(){try{return JSON.parse(localStorage.getItem("links")||"[]")}catch{return[]}}function y(e){localStorage.setItem("links",JSON.stringify(e)),localStorage.setItem("linksUpdatedAt",String(v())),K()}function C(){return w().filter(e=>!e.deleted)}function at(){return C()}function L(e){let t=!1;return{items:e.map(a=>{const n={...a};return n.id||(n.id=ot(),t=!0),n.hasOwnProperty("pinned")||(n.pinned=!1,t=!0),n.updatedAt||(n.updatedAt=v(),t=!0),n}),changed:t}}function et(e){const t=Number(e.updatedAt||0),o=Number(e.deletedAt||0);return Math.max(t,o)}function z(e,t){const o=new Map,a=n=>{const i=o.get(n.id);if(!i){o.set(n.id,n);return}o.set(n.id,et(n)>=et(i)?n:i)};return e.forEach(a),t.forEach(a),Array.from(o.values())}(function(){const{items:t,changed:o}=L(w());o&&y(t)})();function pt(e){return Array.from(new Set(e.map(t=>(t.category||"").trim()).filter(Boolean)))}function ft(e){return Array.from(new Set(e.flatMap(t=>(t.tags||[]).map(o=>o.trim())).filter(Boolean)))}function E(){const e=at(),t=pt(e).sort((a,n)=>a.localeCompare(n,"es",{sensitivity:"base"})),o=ft(e).sort((a,n)=>a.localeCompare(n,"es",{sensitivity:"base"}));q.innerHTML='<option value="">Todas</option>'+t.map(a=>`<option value="${a}">${a}</option>`).join(""),R.innerHTML='<option value="">Todas</option>'+o.map(a=>`<option value="${a}">${a}</option>`).join(""),Z&&(Z.innerHTML=t.map(a=>`<option value="${a}"></option>`).join("")),Q&&(Q.innerHTML=o.map(a=>`<option value="${a}"></option>`).join(""))}function h(){let t=at();const o=q.value,a=R.value,n=(nt.value||"").toLowerCase();if(o&&(t=t.filter(r=>(r.category||"")===o)),a&&(t=t.filter(r=>(r.tags||[]).map(String).includes(a))),n&&(t=t.filter(r=>r.title&&r.title.toLowerCase().includes(n)||r.url&&r.url.toLowerCase().includes(n)||r.category&&r.category.toLowerCase().includes(n)||r.tags&&r.tags.join(",").toLowerCase().includes(n))),t.length===0){Y.innerHTML="<p>No hay enlaces guardados.</p>";return}const i=t.filter(r=>r.pinned),s=t.filter(r=>!r.pinned);i.sort((r,c)=>(r.title||"").localeCompare(c.title||"","es",{sensitivity:"base"})),s.sort((r,c)=>(r.title||"").localeCompare(c.title||"","es",{sensitivity:"base"}));const u=r=>r.map(c=>`
    <div class="link-item${c.pinned?" pinned":""}" data-id="${c.id}">
      <a href="${c.url}" target="_blank">${c.title}</a>
      <div><strong>Categoría:</strong> ${c.category||"-"}</div>
      <div><strong>Etiquetas:</strong> ${c.tags?c.tags.join(", "):"-"}</div>
      <div class="link-actions">
        <button class="edit-link icon-btn" aria-label="Editar" title="Editar">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM21.41 6.34c.39-.39.39-1.02 0-1.41L19.07 2.59a1 1 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>
        </button>
        <button class="pin-link icon-btn" aria-label="${c.pinned?"Desfijar":"Fijar"}" title="${c.pinned?"Desfijar":"Fijar"}">
          ${c.pinned?'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M16 12V4l1-1V2H7v1l1 1v8l-2 2v1h6v7h2v-7h6v-1l-2-2z"/></svg>':'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M16 12V5h1V4H7v1h1v7l-2 2v1h6v6h2v-6h6v-1l-2-2z"/></svg>'}
        </button>
        <button class="delete-link icon-btn btn--danger" aria-label="Eliminar" title="Eliminar">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M6 7h12v2H6V7zm2 3h8l-1 9H9L8 10zm3-7h2l1 1h5v2H3V4h5l1-1z"/></svg>
        </button>
        <button class="share-link icon-btn btn--ghost" aria-label="Compartir" title="Compartir">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7a3.27 3.27 0 0 0 0-1.39l7-4.11A3 3 0 1 0 14 5a3 3 0 0 0 .06.6l-7 4.11a3 3 0 1 0 0 4.58l7.06 4.14A3 3 0 1 0 18 16.08z"/></svg>
        </button>
      </div>
    </div>
  `).join("");Y.innerHTML=(i.length?'<div style="font-size:0.95em;color:#535bf2;margin-bottom:0.5em;">Fijados</div>'+u(i):"")+u(s),document.querySelectorAll(".edit-link").forEach(r=>{r.onclick=function(){const c=this.closest(".link-item"),b=c?c.getAttribute("data-id"):null,l=C().find(m=>m.id===b);window.__openAddModal&&window.__openAddModal(),p.url.value=l.url,p.title.value=l.title,p.tags.value=(l.tags||[]).join(", "),p.category.value=l.category||"",p.setAttribute("data-edit-id",b),p.querySelector('button[type="submit"]').textContent="Guardar cambios",p.scrollIntoView({behavior:"smooth"})}}),document.querySelectorAll(".pin-link").forEach(r=>{r.onclick=function(){const c=this.closest(".link-item"),b=c?c.getAttribute("data-id"):null,l=w(),m=l.findIndex(S=>S.id===b);m!==-1&&(l[m].pinned=!l[m].pinned,l[m].updatedAt=v()),y(l),h()}}),document.querySelectorAll(".delete-link").forEach(r=>{r.onclick=function(){const c=this.closest(".link-item"),b=c?c.getAttribute("data-id"):null;if(confirm("¿Seguro que quieres eliminar este enlace?")){const l=w(),m=l.findIndex(S=>S.id===b);m!==-1&&(l[m].deleted=!0,l[m].deletedAt=v()),y(l),h(),E()}}}),document.querySelectorAll(".share-link").forEach(r=>{r.onclick=function(){const c=this.closest(".link-item"),b=c?c.getAttribute("data-id"):null,l=C().find(m=>m.id===b);navigator.share?navigator.share({title:l.title,text:l.title+(l.category?" ["+l.category+"]":""),url:l.url}):(navigator.clipboard.writeText(l.url),alert("Enlace copiado al portapapeles"))}})}p.addEventListener("submit",e=>{e.preventDefault();const t=p.url.value.trim(),o=p.title.value.trim(),a=p.tags.value.split(",").map(r=>r.trim()).filter(Boolean),n=p.category.value.trim(),i=w(),s=p.getAttribute("data-edit-id");if(s){const r=i.findIndex(c=>c.id===s);r!==-1&&(i[r]={...i[r],url:t,title:o,tags:a,category:n,updatedAt:v(),deleted:!1}),p.removeAttribute("data-edit-id"),p.querySelector('button[type="submit"]').textContent="Añadir enlace"}else i.push({id:ot(),url:t,title:o,tags:a,category:n,pinned:!1,updatedAt:v()});y(i),p.reset(),h(),E();const u=document.getElementById("add-modal");u&&u.classList.contains("open")&&(u.classList.remove("open"),u.setAttribute("aria-hidden","true"))});ut.addEventListener("click",()=>{const e=C(),t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),o=URL.createObjectURL(t),a=document.createElement("a");a.href=o,a.download="enlaces-linkhub.json",a.click(),URL.revokeObjectURL(o)});mt.addEventListener("click",()=>{D.click()});D.addEventListener("change",e=>{const t=e.target.files[0];if(!t)return;const o=new FileReader;o.onload=a=>{try{const n=JSON.parse(a.target.result);if(Array.isArray(n)){const{items:i}=L(n);y(i),h(),E(),alert("Enlaces importados correctamente.")}else if(n&&n.schema===2&&Array.isArray(n.items)){const{items:i}=L(n.items);y(i),h(),E(),alert("Enlaces importados correctamente.")}else alert("El archivo no tiene el formato esperado.")}catch{alert("Error al importar el archivo.")}},o.readAsText(t),D.value=""});q.addEventListener("change",()=>{h()});R.addEventListener("change",()=>{h()});nt.addEventListener("input",h);E();h();const T=window.VITE_DROPBOX_APP_KEY||"",B="/linkhub/links.json";let f=null,O=null,M=!1;function A(e,t){e?(x.textContent=`Dropbox: conectado${t?" ("+t+")":""}`,x.style.color="#1a7f37",j.disabled=!0,P.disabled=!1,I&&(I.disabled=!1)):(x.textContent="Dropbox: desconectado",x.style.color="#888",j.disabled=!1,P.disabled=!0,I&&(I.disabled=!0))}function $(){return Date.now()}function H(){try{return JSON.parse(localStorage.getItem("dropboxAuth")||"null")}catch{return null}}function V(e){f=e,e?localStorage.setItem("dropboxAuth",JSON.stringify(e)):localStorage.removeItem("dropboxAuth")}async function gt(e){const o=new TextEncoder().encode(e),a=await crypto.subtle.digest("SHA-256",o),n=new Uint8Array(a);let i="";for(let s=0;s<n.length;s++)i+=String.fromCharCode(n[s]);return btoa(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function ht(e=64){const t=new Uint8Array(e);return crypto.getRandomValues(t),Array.from(t).map(o=>("0"+o.toString(16)).slice(-2)).join("")}async function bt(){if(!T){alert("Falta configurar VITE_DROPBOX_APP_KEY.");return}const e=ht(64),t=await gt(e);sessionStorage.setItem("dbx_code_verifier",e);const o=window.location.origin+window.location.pathname,n=`https://www.dropbox.com/oauth2/authorize?${new URLSearchParams({client_id:T,response_type:"code",code_challenge:t,code_challenge_method:"S256",token_access_type:"offline",redirect_uri:o}).toString()}`;window.location.assign(n)}async function yt(e){const t=sessionStorage.getItem("dbx_code_verifier"),o=window.location.origin+window.location.pathname,a=new URLSearchParams({code:e,grant_type:"authorization_code",client_id:T,redirect_uri:o,code_verifier:t||""}),n=await fetch("https://api.dropboxapi.com/oauth2/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a});if(!n.ok)throw new Error("No se pudo obtener el token de Dropbox");const i=await n.json(),s=$()+(i.expires_in?i.expires_in*1e3-60*1e3:3*3600*1e3);V({access_token:i.access_token,refresh_token:i.refresh_token||null,expires_at:s,account_id:i.account_id||null})}async function it(){if(!f?.refresh_token)return!1;const e=new URLSearchParams({grant_type:"refresh_token",refresh_token:f.refresh_token,client_id:T}),t=await fetch("https://api.dropboxapi.com/oauth2/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e});if(!t.ok)return!1;const o=await t.json();return f.access_token=o.access_token,f.expires_at=$()+(o.expires_in?o.expires_in*1e3-60*1e3:3*3600*1e3),V(f),!0}async function F(){return f=f||H(),!f||f.expires_at&&f.expires_at<$()&&!await it()?null:f.access_token}async function _(e,t,o={}){const a=await F();if(!a)throw new Error("No autenticado en Dropbox");const n=Object.assign({},o.headers||{},{Authorization:`Bearer ${a}`}),i=await fetch(t,{method:e,...o,headers:n});if(i.status===401){if(!await it())throw new Error("Sesión de Dropbox expirada");return _(e,t,o)}return i}async function rt(){try{const e=await _("POST","https://api.dropboxapi.com/2/users/get_current_account",{headers:{"Content-Type":"application/json"},body:"null"});return e.ok&&(await e.json()).name?.display_name||null}catch{return null}}async function U(){const e=await _("POST","https://content.dropboxapi.com/2/files/download",{headers:{"Dropbox-API-Arg":JSON.stringify({path:B})}});if(e.status===409)return null;if(!e.ok)throw new Error("Descarga de Dropbox fallida");const t=e.headers.get("Dropbox-API-Result");let o=null;try{t&&(o=JSON.parse(t).rev||null)}catch{}const a=await e.text();try{return{data:JSON.parse(a),rev:o}}catch{return{data:null,rev:o}}}async function vt(e){const t=e.split("/").filter(Boolean);if(t.length<=1)return;const o="/"+t.slice(0,t.length-1).join("/");try{await _("POST","https://api.dropboxapi.com/2/files/create_folder_v2",{headers:{"Content-Type":"application/json"},body:JSON.stringify({path:o,autorename:!1})})}catch{}}async function J(e,t=null,o=1){const a=JSON.stringify(e);await vt(B);const i=await _("POST","https://content.dropboxapi.com/2/files/upload",{headers:{"Content-Type":"application/octet-stream","Dropbox-API-Arg":JSON.stringify(t?{path:B,mode:{".tag":"update",update:t},mute:!0}:{path:B,mode:"overwrite",mute:!0})},body:a});if(i.status===409&&o>0)try{const s=await U(),u=W(s?.data),r=z(w(),u);return y(r),J(G(r),s?.rev||null,o-1)}catch{}if(!i.ok)throw new Error("Subida a Dropbox fallida");try{const s=await i.json();s&&s.rev&&localStorage.setItem("dropboxRev",s.rev)}catch{}}function W(e){if(!e)return[];if(e.schema===2&&Array.isArray(e.items)){const{items:a}=L(e.items);return a}const t=Array.isArray(e?.links)?e.links:[],{items:o}=L(t);return o}function G(e){return{schema:2,items:e,updatedAt:v()}}async function wt(){if(!await F()){A(!1);return}const t=await rt();A(!0,t);try{const o=await U(),a=W(o?.data),n=w(),i=z(n,a);y(i),h(),E(),await J(G(i),o?.rev||localStorage.getItem("dropboxRev")||null)}catch(o){console.warn("Sync inicial Dropbox:",o)}}function K(e=800){H()&&(O&&clearTimeout(O),O=setTimeout(()=>{st().catch(()=>{})},e))}async function st(){if(M)return;if(!await F()){A(!1);return}M=!0,x.textContent="Dropbox: sincronizando...";try{const t=await U(),o=W(t?.data),a=w(),n=z(a,o);y(n),h(),E(),await J(G(n),t?.rev||localStorage.getItem("dropboxRev")||null);const i=await rt();A(!0,i),x.textContent="Dropbox: sincronizado"}catch(t){console.warn("Sync Dropbox:",t),x.textContent="Dropbox: error de sincronización"}finally{M=!1}}j.addEventListener("click",bt);P.addEventListener("click",()=>{st()});document.addEventListener("click",e=>{const t=e.target;t&&t.id==="dropbox-disconnect"&&(V(null),A(!1))});window.addEventListener("online",()=>K(200));function xt(){if("serviceWorker"in navigator){if(navigator.serviceWorker.controller)try{navigator.serviceWorker.controller.postMessage({type:"GET_SW_VERSION"})}catch{}navigator.serviceWorker.ready&&navigator.serviceWorker.ready.then(e=>{try{e&&e.active&&e.active.postMessage({type:"GET_SW_VERSION"})}catch{}}).catch(()=>{})}}"serviceWorker"in navigator&&(navigator.serviceWorker.addEventListener("message",e=>{const t=e.data||{};t.type==="SW_VERSION"&&tt&&(tt.textContent=String(t.version))}),setTimeout(xt,500));(async function(){try{const t=new URL(window.location.href),o=t.searchParams.get("code");o&&(await yt(o),t.searchParams.delete("code"),t.searchParams.delete("state"),history.replaceState({},"",t.toString()))}catch(t){console.warn("OAuth Dropbox:",t)}finally{f=H(),A(!!f),f&&(wt(),setInterval(()=>K(0),5*60*1e3))}})();
